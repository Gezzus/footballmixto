<!DOCTYPE html>
<html lang="en" class="h-100">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LGM Sports - Event</title>
    <script src="//code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="//stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.12/handlebars.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js" ></script>
    <link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <link href="/web/css/index.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <script type="text/javascript" src="/web/js/Utils.js"></script>
    <script type="text/javascript" src="/web/js/base.js"></script>
    <script type="text/javascript" src="/web/js/actions.js"></script>
    <script type="text/javascript" src="/web/js/game.js"></script>
</head>

<body class="d-flex flex-column h-100">

  <header class="frontpage">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">LGM Sports</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto" id="navigationBar">
                    <li class="nav-item"> <a class="nav-link" href="/web/index.html">Home </a> </li>
                    <li class="nav-item"> <a class="nav-link" href="/web/events.html">Events</a> </li>
                    <!-- <li class="nav-item"> <a class="nav-link" href="#profile">Profile</a> </li> -->
                    <!-- <li class="nav-item"> <a class="nav-link" href="#admin">Admin</a> </li> -->
                    <li class="nav-item"> <a class="nav-link" href="/api/logout">Logout</a> </li>
                </ul>
            </div>
        </div>
    </nav>
  </header>
<!-- Main -->
<main role="main">
  <div id="body" class="container my-3">
  </div>
</main>
<!-- Footer -->
<footer class="footer navbar-fixed-bottom mt-auto py-3 bg-dark">
    <div class="container">
        <p class="m-0 text-center text-white">Made with â™¥ by a bunch of guys.</p>
    </div>
    <!-- /.container -->
</footer>
</body>

<script id="event-template" type="text/x-handlebars-template">
  <div class="card w-100 mb-3">
    <div class="card-body">
      <h2 class="card-title">{{game.type.name}}</h2>
      <p class="card-text">{{game.date}}</p>
    </div>
  </div>
  <div class="row mb-3">
      <div class="col-lg-4 col-sm-12 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Actions</h5>
          <ul class="list-group mb-3">
            {{#ifEq game.status 0}}
            <li class="list-group-item py-2">
              {{#if playing}}
              <div class="text-center"><a href="#{{game.id}}" onclick="removePlayer({{game.id}}, {{user.playerId}}).always(refresh)" class="card-link">Leave</a></div>
              {{else}}
              <div class="text-center"><a href="#{{game.id}}" onclick="addPlayer({{game.id}}, {{user.playerId}}).always(refresh)" class="card-link">Join</a></div>
              {{/if}}
            </li>
            {{else}}
            {{#unless user.isAdmin}}
            <li class="list-group-item py-2"> <div class="text-center"><a class="card-link" disabled>No actions available</a></div> </li>
            {{/unless}}
            {{/ifEq}}
            {{#if user.isAdmin}}
            {{#ifEq game.status 0}}
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="changeGameStatus('{{game.id}}', 1).always(refresh)" class="card-link">Mark as finished</a></div> </li>
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="changeGameStatus('{{game.id}}', 3).always(refresh)" class="card-link">Hide event</a></div></li>
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="deleteGame('{{game.id}}').always(function(result) { location.href = '/' })" class="card-link">Delete</a></div></li>
            {{/ifEq}}
            {{#ifEq game.status 1}}
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="changeGameStatus('{{game.id}}', 0).always(refresh)" class="card-link">Mark as unfinished</a></div> </li>
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="changeGameStatus('{{game.id}}', 3).always(refresh)" class="card-link">Hide event</a></div></li>
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="deleteGame('{{game.id}}').always(function(result) { location.href = '/' })" class="card-link">Delete</a></div></li>
            {{/ifEq}}
            {{#ifEq game.status 3}}
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="changeGameStatus('{{game.id}}', 0).always(refresh)" class="card-link">Reset event</a></div></li>
            <li class="list-group-item py-2"> <div class="text-center"><a href="#{{game.id}}" onclick="deleteGame('{{game.id}}').always(function(result) { location.href = '/' })" class="card-link">Delete</a></div></li>
            {{/ifEq}}
            {{/if}}
          </ul>
        </div>
      </div>
      </div>
<div class="col-lg-4 col-sm-12 mb-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Current attendants</h5>
        <ul class="list-group mb-3">
          {{#each genders}}
          <li class="list-group-item d-flex justify-content-between align-items-center py-2">
            <span class="text-center">{{name}}</span>
            <span class="progress w-75">
              <span class="progress-bar progress-bar-striped" role="progressbar" style="width: {{lookup (lookup ../game.totals id) 'percentage'}}%;" aria-valuenow="{{lookup (lookup ../game.totals id) 'count'}}" aria-valuemin="0" aria-valuemax="{{lookup (lookup ../game.totals id) 'max'}}">{{lookup (lookup ../game.totals id) 'count'}}</span>
            </span>
          </li>
          {{/each}}
        </ul>
        {{#if user.isAdmin}}{{#ifEq game.status 1}}{{else}}
        <div class="text-center"><a href="#{{game.id}}" onclick='preselectPlayers({{json game}}).always(refresh)' class="card-link">Preselect</a></div>
        {{/ifEq}}{{/if}}
      </div>
    </div>
  </div>
  <div class="col-lg-4 col-sm-12 mb-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Add an outsider</h5>
        <form id="addextra">
          <div class="form-group">
            <input class="form-control mb-2" type="text" name="nickName" required="required" placeholder="Nickname" {{#ifEq game.status 1}}disabled{{/ifEq}}>
            <select class="form-control" name="genderId" {{#ifEq game.status 1}}disabled{{/ifEq}}>
                {{#each genders}}
                <option value="{{id}}">{{name}}</option>
                {{/each}}
            </select>
          </div>
        </form>
        {{#ifEq game.status 1}}
        {{else}}
        <div class="text-center"><a href="#{{game.id}}" onclick="addExtra({{game.id}}, addextra).always(refresh)" class="card-link">Add</a></div>
        {{/ifEq}}
      </div>
    </div>
    </div>
    <div class="col-lg-4 col-sm-12 mb-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Bench</h5>
        <ul class="list-group mb-3">
          {{#each genders}}
          <li class="list-group-item py-1 list-group-item-secondary">{{name}}</li>
          {{#each ../game.teamless}}
          {{#ifEq genderId ../id}}
          <li class="list-group-item py-1">
            <span class="align-middle">{{nickName}}</span>
            {{#ifEq ../../game.status 0}}
            {{#if ../../user.isAdmin}}
            <div class="btn-group btn-group-sm float-right" role="group" aria-label="First group">
              {{#each ../../game.teams}}
              <button type="button" class="btn btn-primary" onclick="transferPlayer({{../../../game.id}},{{../id}},{{id}}).always(refresh)">{{id}}</button>
              {{/each}}
              <button type="button" class="btn btn-secondary" onclick="removePlayer({{../../game.id}},{{id}}).always(refresh)">Remove</button>
            </div>
            {{/if}}
            {{/ifEq}}
          </li>
          {{/ifEq}}
          {{/each}}
          {{/each}}
          <li class="list-group-item py-1 list-group-item-secondary">Next week players</li>
          {{#each game.teamless}}
          {{#unless genderId}}
          <li class="list-group-item py-1">
            <span class="align-middle">{{nickName}}</span>
          </li>
          {{/unless}}
          {{/each}}
        </ul>
      </div>
    </div>
    </div>

<div class="col-lg-8 col-sm-12 mb-3">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Teams</h5>
        <div class="row">
          {{#each game.teams}}
          <div class="col-lg-6 col-sm-12">
            <ul class="list-group mb-3">
              <li class="list-group-item py-1 list-group-item-secondary">{{name}}</li>
              {{#each players}}
              <li class="list-group-item py-1">
                <span class="align-middle">{{nickName}}</span>
                {{#ifEq ../../game.status 0}}
                {{#if ../../user.isAdmin}}
                <div class="btn-group btn-group-sm float-right" role="group" aria-label="First group">
                  {{#each ../../game.teams}}
                  <button type="button" class="btn btn-primary {{#ifEq id ../../id}} disabled {{/ifEq}}" onclick="transferPlayer({{../../../game.id}},{{../id}},{{id}}).always(refresh)">{{id}}</button>
                  {{/each}}
                  <button type="button" class="btn btn-secondary" onclick="transferPlayer({{../../game.id}},{{id}},null).always(refresh)">Bench</button>
                </div>
                {{/if}}
                {{/ifEq}}
              </li>
              {{/each}}
              </ul>
            </div>
          {{/each}}
        </div>
      </div>
    </div>
    </div>

  </div>

  <div class="card-columns">

  </div>
</script>
</body>
</html>
